# basic bqn, general solution
#Dot â† +Ëâˆ˜Ã—â‰1â€¿âˆ

# optimized bqn
#Dot â† {
#  1â‰¡âŠ‘â‰ ğ•¨? â‰+Â´ (â¥Šğ•¨) Ã— <Ë˜ ğ•©;
#  1â‰¡1âŠ‘â‰¢ğ•©? (â‰ ğ•¨)â€¿1â¥Š (+Â´(â¥Šğ•©)âŠ¸Ã—)Ë˜ğ•¨;
#  ğ•¨ +Ëâˆ˜Ã—â‰1â€¿âˆ ğ•©
#}

cblasRowMajorâ†101
cblasColMajorâ†102

cblasNoTransâ†111
cblasTransâ†112
cblasConjTransâ†113
cblasConjNoTransâ†114
cblasTransOptionsâ†âŸ¨
  cblasNoTrans
  cblasTrans
âŸ©

#path_blas_lib â† "/Users/jra/.local/share/virtualenvs/deeplearning-TAU9TGrL/lib/python3.10/site-packages/numpy/.dylibs/libopenblas64_.0.dylib"  # no cblas
#path_blas_lib â† "/usr/local/lib/libgslcblas.dylib"  # gsl (not parallelized)
#path_blas_lib â† "/usr/local/Cellar/openblas/0.3.20/lib/libopenblasp-r0.3.20.dylib"  # brew package (good)
path_blas_lib â† "/Users/jra/pks/openblas/lib/libopenblas_haswellp-r0.3.17.dylib"  # compiled locally (best)

p â† @
#                                   lay tA  tB  m   n   k   Î±   A    lda B    ldb Î²   C    ldc
p â†© (1-Ëœ+`Ã—Â¬)âˆ˜=âŸœâŠâŠ¸âŠ” " & cblas_dgemm u32 u32 u32 i32 i32 i32 f64 *f64 i32 *f64 i32 f64 &f64 i32"
gemm â† path_blas_lib â€¢FFI p
#                                   lay tA  m   n   Î±   A    lda x    incx Î²  y    incy
p â†© (1-Ëœ+`Ã—Â¬)âˆ˜=âŸœâŠâŠ¸âŠ” " & cblas_dgemv u32 u32 i32 i32 f64 *f64 i32 *f64 i32 f64 &f64 i32"
gemv â† path_blas_lib â€¢FFI p

Cblas_gemm_ab â† {
  aâ€¿b:
  mâ€¿kâ†â‰¢a â‹„ kxâ€¿nâ†â‰¢b â‹„ !kâ‰¡kx
  câ†mâ€¿nâ¥Š0
  Gemm cblasRowMajorâ€¿cblasNoTransâ€¿cblasNoTransâ€¿mâ€¿nâ€¿kâ€¿1â€¿aâ€¿kâ€¿bâ€¿nâ€¿0â€¿câ€¿n
}

Cblas_gemv_axpby â† {
  transâ€¿aâ€¿xâ€¿betaâ€¿y:
  ctrans â† transâŠ‘cblasTransOptions  # 0-no trans, 1-trans
  mâ€¿nâ†â‰¢a â‹„ nxâ†âŠ‘â‰¢x â‹„ nyâ†âŠ‘â‰¢y
  !nx=transâŠ‘nâ€¿m â‹„ !ny=transâŠ‘mâ€¿n
  incx â† 1
  incy â† 1
  alpha â† 1
  Gemv cblasRowMajorâ€¿ctransâ€¿mâ€¿nâ€¿alphaâ€¿aâ€¿nâ€¿xâ€¿incxâ€¿betaâ€¿yâ€¿incy
}

Cblas_gemv_ax â† {
  transâ€¿aâ€¿x:
  ctrans â† transâŠ‘cblasTransOptions  # 0-no trans, 1-trans
  mâ€¿nâ†â‰¢a
  y â† (transâŠ‘mâ€¿n)â€¿1â¥Š0
  nxâ†âŠ‘â‰¢x â‹„ nyâ†âŠ‘â‰¢y
  !nx=transâŠ‘nâ€¿m â‹„ !ny=transâŠ‘mâ€¿n
  incx â† 1
  incy â† 1
  alpha â† 1
  beta â† 0
  Gemv cblasRowMajorâ€¿ctransâ€¿mâ€¿nâ€¿alphaâ€¿aâ€¿nâ€¿xâ€¿incxâ€¿betaâ€¿yâ€¿incy
}

Dot â‡ {
  1â‰¡âŠ‘â‰ ğ•¨? â‰ Cblas_gemv_ax 1â€¿ğ•©â€¿(â‰ğ•¨);
  1â‰¡1âŠ‘â‰¢ğ•©? Cblas_gemv_ax 0â€¿ğ•¨â€¿ğ•©;
  Cblas_gemm_ab ğ•¨â€¿ğ•©
}
