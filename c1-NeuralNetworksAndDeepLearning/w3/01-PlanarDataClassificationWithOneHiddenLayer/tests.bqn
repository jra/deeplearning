nn â† â€¢Import "nn-1layer.bqn"

n_xâ€¿n_hâ€¿n_y â† 3â¥Š@
x_assessâ€¿y_assess â† 2â¥Š@
parameters â† @

LayerSizesTesCase â† {
  Â·:
  rng â† â€¢MakeRand 1
  x_assess â† 5â€¿3 rng.Range 0
  y_assess â† 2â€¿3 rng.Range 0
  x_assessâ€¿y_assess
}

x_assessâ€¿y_assess â†© LayerSizesTesCase @
n_xâ€¿n_hâ€¿n_y â†© nn.LayerSizes x_assessâ€¿y_assess
â€¢Out "The size of the input layer is: n_x = "âˆ¾ â€¢Repr n_x
â€¢Out "The size of the hidden layer is: n_h = "âˆ¾ â€¢Repr n_h
â€¢Out "The size of the output layer is: n_y = "âˆ¾ â€¢Repr n_y

InitializeParametersTestCase â† {
  Â·:
  n_xâ€¿n_hâ€¿n_y â† 2â€¿4â€¿1
  n_xâ€¿n_hâ€¿n_y
}

n_xâ€¿n_hâ€¿n_y â†© InitializeParametersTestCase @

parameters â†© nn.InitializeParameters n_xâ€¿n_hâ€¿n_y
#â€¢Out "W1 = "âˆ¾â€¢Repr 0âŠ‘parameters
#â€¢Out "b1 = "âˆ¾â€¢Repr 1âŠ‘parameters
#â€¢Out "W2 = "âˆ¾â€¢Repr 2âŠ‘parameters
#â€¢Out "b2 = "âˆ¾â€¢Repr 3âŠ‘parameters

â€¢Out "W1 = "âˆ¾â€¢Repr parameters.w1
â€¢Out "b1 = "âˆ¾â€¢Repr parameters.b1
â€¢Out "W2 = "âˆ¾â€¢Repr parameters.w2
â€¢Out "b2 = "âˆ¾â€¢Repr parameters.b2

ForwardPropagationTestCase â† {
  Â·:
  #rng â† â€¢MakeRand 1
  #x_assess â† {ğ•© Normal 0â€¿1}Â¨ 2â€¿3 rng.Range 0
  x_assess â† [[ 1.62434536, -0.61175641, -0.52817175]
              [-1.07296862,  0.86540763, -2.3015387 ]]
  #b1 â† {ğ•© Normal 0â€¿1}Â¨ 4â€¿1 rng.Range 0
  b1 â† [[ 1.74481176]
        [-0.7612069 ]
        [ 0.3190391 ]
        [-0.24937038]]
  b2 â† 1â€¿1â¥ŠÂ¯1.3
  parameters â† {
    w1â‡[[-0.00416758, -0.00056267]
        [-0.02136196,  0.01640271]
        [-0.01793436, -0.00841747]
        [ 0.00502881, -0.01245288]]
    b1â‡b1
    w2â‡[[-0.01057952, -0.00909008, 0.00551454, 0.02292208]]
    b2â‡b2
  }
  x_assessâ€¿parameters
}

x_assessâ€¿parameters â†© ForwardPropagationTestCase @

â€¢Show x_assess
â€¢Out "w1"
â€¢Show parameters.w1
â€¢Out "b1"
â€¢Show parameters.b1
â€¢Out "w2"
â€¢Show parameters.w2
â€¢Out "b2"
â€¢Show parameters.b2

cache â† nn.ForwardPropagation x_assessâ€¿parameters
Mean â† { (+Â´â¥Šğ•©) Ã· (â‰ â¥Šğ•©) }  # TODO better way?
â€¢Show (Mean cache.z1)â€¿(Mean cache.a1)â€¿(Mean cache.z2)â€¿(Mean cache.a2)

ComputeCostTestCase â† {
  Â·:
  a2 â† [[0.5002307,  0.49985831, 0.50023963]]
  y_assess â† [[1, 0, 0]]
  parameters â† {
    w1 â‡ [[-0.00416758, -0.00056267]
          [-0.02136196,  0.01640271]
          [-0.01793436, -0.00841747]
          [ 0.00502881, -0.01245288]]
    w2 â‡ [[-0.01057952, -0.00909008,  0.00551454,  0.02292208]]
    b1 â‡ [[0]
          [0]
          [0]
          [0]]
    b2 â‡ [[0]]
  }
  a2â€¿y_assessâ€¿parameters
}

a2 â† @
a2â€¿y_assessâ€¿parameters â†© ComputeCostTestCase @
cost â† nn.ComputeCost a2â€¿y_assessâ€¿parameters
â€¢Show cost

BackwardPropagationTestCase â† {
  Â·:
  parameters â† {
    w1 â‡ [[-0.00416758, -0.00056267]
          [-0.02136196,  0.01640271]
          [-0.01793436, -0.00841747]
          [ 0.00502881, -0.01245288]]
    w2 â‡ [[-0.01057952, -0.00909008,  0.00551454,  0.02292208]]
    b1 â‡ [[0]
          [0]
          [0]
          [0]]
    b2 â‡ [[0]]
  }
  cache â† {
    a1 â‡ [[-0.00616578,  0.0020626 ,  0.00349619]
          [-0.05225116,  0.02725659, -0.02646251]
          [-0.02009721,  0.0036869 ,  0.02883756]
          [ 0.02152675, -0.01385234,  0.02599885]]
    a2 â‡ [[0.5002307 , 0.49985831, 0.50023963]]
    z1 â‡ [[-0.00616586,  0.0020626 ,  0.0034962 ]
          [-0.05229879,  0.02726335, -0.02646869]
          [-0.02009991,  0.00368692,  0.02884556]
          [ 0.02153007, -0.01385322,  0.02600471]]
    z2 â‡ [[ 0.00092281, -0.00056678,  0.00095853]]
  }
  x_assess â† [[ 1.62434536, -0.61175641, -0.52817175]
              [-1.07296862,  0.86540763, -2.3015387 ]]
  y_assess â† [[1, 0, 1]]
  parametersâ€¿cacheâ€¿x_assessâ€¿y_assess
}

parametersâ€¿cacheâ€¿x_assessâ€¿y_assess â†© BackwardPropagationTestCase @

grads â† nn.BackwardPropagation parametersâ€¿cacheâ€¿x_assessâ€¿y_assess

â€¢Out "dw1: "âˆ¾â€¢Repr grads.dw1
â€¢Out "db1: "âˆ¾â€¢Repr grads.db1
â€¢Out "dw2: "âˆ¾â€¢Repr grads.dw2
â€¢Out "db2: "âˆ¾â€¢Repr grads.db2

UpdateParametersTestCase â† {
  Â·:
  parameters â† {
    w1 â‡ [[-0.00643025,  0.01936718]
          [-0.02410458,  0.03978052]
          [-0.01653973, -0.02096177]
          [ 0.01046864, -0.05990141]]
    b1 â‡ [[-1.02420756eÂ¯06]
          [ 1.27373948eÂ¯05]
          [ 8.32996807eÂ¯07]
          [-3.20136836eÂ¯06]]
    w2 â‡ [[-0.01041081, -0.04463285,  0.01758031,  0.04747113]]
    b2 â‡ [[0.00010457]]
  }
  grads â† {
    dw1 â‡ [[ 0.00023322, -0.00205423]
           [ 0.00082222, -0.00700776]
           [-0.00031831,  0.0028636 ]
           [-0.00092857,  0.00809933]]
    dw2 â‡ [[-1.75740039eÂ¯05,  3.70231337eÂ¯03, -1.25683095eÂ¯03, -2.55715317eÂ¯03]]
    db1 â‡ [[ 1.05570087eÂ¯07]
           [-3.81814487eÂ¯06]
           [-1.90155145eÂ¯07]
           [ 5.46467802eÂ¯07]]
    db2 â‡ [[-1.0892314eÂ¯05]]
  }
  parametersâ€¿grads
}

parametersâ€¿grads â†© UpdateParametersTestCase @
#â€¢Show parameters
#â€¢Show grads

parameters â†© nn.UpdateParameters parametersâ€¿gradsâ€¿1.2

â€¢Out "w1: "âˆ¾â€¢Repr parameters.w1
â€¢Out "b1: "âˆ¾â€¢Repr parameters.b1
â€¢Out "w2: "âˆ¾â€¢Repr parameters.w2
â€¢Out "b2: "âˆ¾â€¢Repr parameters.b2

NNModelTestCase â† {ğ•¤
  x_assess â† [[ 1.62434536, -0.61175641, -0.52817175]
              [-1.07296862,  0.86540763, -2.3015387 ]]
  y_assess â† [[1, 0, 1]]
  x_assessâ€¿y_assess
}

x_assessâ€¿y_assess â†© NNModelTestCase @

â€¢Out "x_assess = "
â€¢Show x_assess
â€¢Out "y_assess = "
â€¢Show y_assess

parameters â†© nn.NNModel x_assessâ€¿y_assessâ€¿4â€¿1.02â€¿10000â€¿1

â€¢Out "w1 = "
â€¢Show parameters.w1
â€¢Out "b1 = "
â€¢Show parameters.b1
â€¢Out "w2 = "
â€¢Show parameters.w2
â€¢Out "b2 = "
â€¢Show parameters.b2

PredictTestCase â† {ğ•¤
  parameters â† {
    w1 â‡ [[-0.00615039,  0.0169021 ]
          [-0.02311792,  0.03137121]
          [-0.0169217 , -0.01752545]
          [ 0.00935436, -0.05018221]]
    b1 â‡ [[-8.97523455eÂ¯07]
          [ 8.15562092eÂ¯06]
          [ 6.04810633eÂ¯07]
          [-2.54560700eÂ¯06]]
    w2 â‡ [[-0.0104319 , -0.04019007,  0.01607211,  0.04440255]]
    b2 â‡ [[9.14954378eÂ¯05]]
  }
  x_assess â† [[ 1.62434536, -0.61175641, -0.52817175]
              [-1.07296862,  0.86540763, -2.3015387 ]]
  parametersâ€¿x_assess
}

parametersâ€¿x_assess â†© PredictTestCase @

predictions â† nn.Predict parametersâ€¿x_assess

â€¢Out "predictions:"
â€¢Show predictions
