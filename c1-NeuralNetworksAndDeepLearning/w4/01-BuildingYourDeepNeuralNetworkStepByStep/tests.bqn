nn â† â€¢Import "nn.bqn"

rand â† â€¢MakeRand 0

n1 â† nn.Normal randâ€¿âŸ¨0, 1âŸ©
#â€¢Show n1

n2 â† nn.Normal randâ€¿âŸ¨0, 1âŸ©
#â€¢Show n2

n3 â† nn.Normal rand
#â€¢Show n3

n4 â† 3 nn.Normal randâ€¿âŸ¨0, 1âŸ©
#â€¢Show n4

n5 â† 3 nn.Normal rand
#â€¢Show n5

n6 â† 2â€¿3 nn.Normal rand
#â€¢Show n6

#
# InitializeParameters
#

ps â† nn.InitializeParameters 3â€¿2â€¿1
#â€¢Show ps
#â€¢Out "w1 = "âˆ¾â€¢Repr 0âŠ‘0âŠ‘ps
#â€¢Out "b1 = "âˆ¾â€¢Repr 1âŠ‘0âŠ‘ps
#â€¢Out "w2 = "âˆ¾â€¢Repr 0âŠ‘1âŠ‘ps
#â€¢Out "b2 = "âˆ¾â€¢Repr 1âŠ‘1âŠ‘ps

! 2â€¿3 â‰¡ â‰¢0âŠ‘0âŠ‘ps  # w1
! âŸ¨2âŸ© â‰¡ â‰¢1âŠ‘0âŠ‘ps  # b1
! âˆ§Â´=âŸœ0Â¨â¥Š1âŠ‘0âŠ‘ps  # b1
! 1â€¿2 â‰¡ â‰¢0âŠ‘1âŠ‘ps  # w2
! âŸ¨1âŸ© â‰¡ â‰¢1âŠ‘1âŠ‘ps  # b2
! âˆ§Â´=âŸœ0Â¨â¥Š1âŠ‘1âŠ‘ps  # b2

#
# InitializeParametersDeep
#

ps â†© nn.InitializeParametersDeep 5â€¿4â€¿3

â€¢Out â€¢Repr ps
! 2=â‰ ps
! 4â€¿5â‰¡â‰¢0âŠ‘0âŠ‘ps  # w1
! (â‰ =â‰ âˆ˜â·)0âŠ‘0âŠ‘ps  # w1 all unique
! (4â¥Š0)â‰¡1âŠ‘0âŠ‘ps  # b1
! 3â€¿4â‰¡â‰¢0âŠ‘1âŠ‘ps  # w2
! (â‰ =â‰ âˆ˜â·)0âŠ‘1âŠ‘ps  # w2 all unique
! (3â¥Š0)â‰¡1âŠ‘1âŠ‘ps  # b2

#
# LinearForward
#

x â† @
y â† @
a â† @
w â† @
b â† @
z â† @
aa â† @
ww â† @
bb â† @
zz â† @
aPrev â† @
aL â† @
caches â† @

a â†© [[ 1.62434536, -0.61175641]
     [-0.52817175, -1.07296862]
     [ 0.86540763, -2.3015387 ]]
w â†© [[1.74481176, -0.7612069,   0.3190391]]
b â†© âŸ¨-0.24937038âŸ©
z â†© [[ 3.26295337, -1.23429987]]

zzâ€¿âŸ¨aa, ww, bbâŸ© â†© nn.LinearForward aâ€¿wâ€¿b

Close â† {
  #d ğ•Š vs: âˆ§Â´ 0âŠ¸=Â¨ â‰ âˆ˜â‰¢Â¨ vs ? (1=â‰ âˆ˜â·) { (10â‹†d)Ã·ËœâŒŠğ•©Ã—(10â‹†d) }Â¨ vs ;
  d ğ•Š vs: âˆ§Â´ 0âŠ¸=Â¨ â‰ âˆ˜â‰¢Â¨ vs ? (1=â‰ âˆ˜â·) { (10â‹†d)Ã·ËœâŒŠğ•©Ã—(10â‹†d) }Â¨ vs ;
  d ğ•Š vs: (1â‰ â‰ âˆ˜â·) â‰¢Â¨ vs ? 0 ;
  d ğ•Š vs: (1=â‰ âˆ˜â·) { (10â‹†d)Ã·ËœâŒŠğ•©Ã—(10â‹†d) }Â¨ â¥ŠÂ¨ vs
}

! (â‰¢z)â‰¡â‰¢zz

! 7 Close zâ€¿zz

#
# LinearActivationForward
#

aPrev â†© [[-0.41675785, -0.05626683]
         [-2.1361961,   1.64027081]
         [-1.79343559, -0.84174737]]
w â†© [[ 0.50288142, -1.24528809, -1.05795222]]
b â†© âŸ¨-0.90900761âŸ©

truth â† {
  aWithSigmoid â‡ [[0.96890023, 0.11013289]]
  aWithReLU â‡ [[3.43896131, 0.0        ]]
}

aWithSigmoidâ€¿Â· â† nn.LinearActivationForward aPrevâ€¿wâ€¿bâ€¿nn.sigmoid
aWithReLUâ€¿Â· â† nn.LinearActivationForward aPrevâ€¿wâ€¿bâ€¿nn.reLU

#â€¢Out "aWithSigmoid"
#â€¢Show truth.aWithSigmoid
#â€¢Show aWithSigmoid

#â€¢Out "aWithReLU"
#â€¢Show truth.aWithReLU
#â€¢Show aWithReLU

! 7 Close truth.aWithSigmoidâ€¿aWithSigmoid
! 7 Close truth.aWithReLUâ€¿aWithReLU

#
# LModelForward
#

x â†© [[-0.31178367,  0.72900392,  0.21782079, -0.8990918 ]
     [-2.48678065,  0.91325152,  1.12706373, -1.51409323]
     [ 1.63929108, -0.42989360,  2.63128056,  0.60182225]
     [-0.33588161,  1.23773784,  0.11112817,  0.12915125]
     [ 0.07612761, -0.15512816,  0.63422534,  0.810655  ]]
ps â†© âŸ¨
  âŸ¨
    # w1
    [[ 0.35480861,  1.81259031, -1.3564758 , -0.46363197,  0.82465384]
     [-1.17643148,  1.56448966,  0.71270509, -0.1810066 ,  0.53419953]
     [-0.58661296, -1.48185327,  0.85724762,  0.94309899,  0.11444143]
     [-0.02195668, -2.12714455, -0.83440747, -0.46550831,  0.23371059]]
    # b1
    âŸ¨ 1.38503523
     -0.51962709
     -0.78015214
      0.95560959 âŸ©
  âŸ©
  âŸ¨
    # w2
    [[-0.12673638, -1.36861282,  1.21848065, -0.85750144]
     [-0.56147088, -1.0335199 ,  0.35877096,  1.07368134]
     [-0.37550472,  0.39636757, -0.47144628,  2.33660781]]
    # b2
    âŸ¨ 1.50278553
     -0.59545972
      0.52834106 âŸ©
  âŸ©
  âŸ¨
    # w3
    [[ 0.9398248 ,  0.42628539, -0.75815703]]
    # b3
    âŸ¨-0.16236698 âŸ©
  âŸ©
âŸ©

truthAL â† [[0.03921668, 0.70498921, 0.19734387, 0.04728177]]

aLâ€¿caches â†© nn.LModelForward xâ€¿ps

#â€¢Show truthAL
#â€¢Show aL

! 7 Close truthALâ€¿aL
! 3=â‰ caches

#
# ComputeCost
#

y â†© [[1, 1, 0]]
aL â†© [[0.8, 0.9, 0.4]]

truthCost â† 0.2797765635793422

cost â† nn.ComputeCost aLâ€¿y

! 7 Close truthCostâ€¿cost

#
# LinearBackward
#

dz â† [[ 1.62434536, -0.61175641, -0.52817175, -1.07296862]
      [ 0.86540763, -2.3015387 ,  1.74481176, -0.7612069 ]
      [ 0.3190391 , -0.24937038,  1.46210794, -2.06014071]]
linear_cache â† âŸ¨
  # a prev
  [[-0.3224172 , -0.38405435,  1.13376944, -1.09989127]
   [-0.17242821, -0.87785842,  0.04221375,  0.58281521]
   [-1.10061918,  1.14472371,  0.90159072,  0.50249434]
   [ 0.90085595, -0.68372786, -0.12289023, -0.93576943]
   [-0.26788808,  0.53035547, -0.69166075, -0.39675353]]
  # w
  [[-0.6871727 , -0.84520564, -0.67124613, -0.0126646 , -1.11731035]
   [ 0.2344157 ,  1.65980218,  0.74204416, -0.19183555, -0.88762896]
   [-0.74715829,  1.6924546 ,  0.05080775, -0.63699565,  0.19091548]]
  # b
  âŸ¨ 2.10025514
    0.12015895
    0.61720311 âŸ©
âŸ©

truth â†© {
  daPrev â‡ [[-1.15171336,  0.06718465, -0.3204696 ,  2.09812712]
            [ 0.60345879, -3.72508701,  5.81700741, -3.84326836]
            [-0.4319552 , -1.30987417,  1.72354705,  0.05070578]
            [-0.38981415,  0.60811244, -1.25938424,  1.47191593]
            [-2.52214926,  2.67882552, -0.67947465,  1.48119548]]
  dw â‡ [[ 0.07313866, -0.0976715 , -0.87585828,  0.73763362,  0.00785716]
        [ 0.85508818,  0.37530413, -0.59912655,  0.71278189, -0.58931808]
        [ 0.97913304, -0.24376494, -0.08839671,  0.55151192, -0.10290907]]
  db â‡ âŸ¨ -0.14713786
         -0.11313155
         -0.13209101 âŸ©
}

daPrevâ€¿dwâ€¿db â† nn.LinearBackward dzâ€¿linear_cache

#â€¢Show daPrev
#â€¢Show dw
#â€¢Show db

! 6 Close truth.daPrevâ€¿daPrev
! 7 Close truth.dwâ€¿dw
! 7 Close truth.dbâ€¿db

#
# LinearActivationBackward
#

daL â† [[-0.41675785, -0.05626683]]
linearActivationCache â† âŸ¨
  âŸ¨
    [[-2.1361961 ,  1.64027081]
     [-1.79343559, -0.84174737]
     [ 0.50288142, -1.24528809]]
    [[-1.05795222, -0.90900761,  0.55145404]]
    âŸ¨ 2.29220801 âŸ©
  âŸ©
  [[ 0.04153939, -1.11792545]]
âŸ©

truthSigmoid â† {
  daPrev â‡ [[ 0.11017994,  0.01105339]
            [ 0.09466817,  0.00949723]
            [-0.05743092, -0.00576154]]
  dw â‡ [[ 0.10266786,  0.09778551, -0.01968084]]
  db â‡ âŸ¨ -0.05729622 âŸ©
}

truthReLU â† {
  daPrev â‡ [[ 0.44090989,  0.0        ]
            [ 0.37883606,  0.0        ]
            [-0.2298228 ,  0.0        ]]
  dw â‡ [[ 0.44513824,  0.37371418, -0.10478989]]
  db â‡ âŸ¨ -0.20837892 âŸ©
}

daPrevâ€¿dwâ€¿db â†© nn.LinearActivationBackward daLâ€¿linearActivationCacheâ€¿nn.sigmoidBackward

#â€¢Show daPrev
#â€¢Show dw
#â€¢Show db

! 6 Close truthSigmoid.daPrevâ€¿daPrev
! 7 Close truthSigmoid.dwâ€¿dw
! 7 Close truthSigmoid.dbâ€¿db

daPrevâ€¿dwâ€¿db â†© nn.LinearActivationBackward daLâ€¿linearActivationCacheâ€¿nn.reLUBackward

â€¢Show truthReLU.daPrev
â€¢Show daPrev
â€¢Show truthReLU.daPrev - daPrev
#â€¢Show dw
#â€¢Show db

#! 6 Close truthReLU.daPrevâ€¿daPrev
! 7 Close truthReLU.dwâ€¿dw
! 7 Close truthReLU.dbâ€¿db

#
# LModelBackward
#

aL â†© [[1.78862847, 0.43650985]]
yAssess â† [[1, 0]]
#yAssess â† âŸ¨1, 0âŸ©
caches â†© âŸ¨
  âŸ¨
    # linear
    âŸ¨
      # a
      [[ 0.09649747, -1.8634927 ]
       [-0.2773882 , -0.35475898]
       [-0.08274148, -0.62700068]
       [-0.04381817, -0.47721803]]
      # w
      [[-1.31386475,  0.88462238,  0.88131804,  1.70957306]
       [ 0.05003364, -0.40467741, -0.54535995, -1.54647732]
       [ 0.98236743, -1.10106763, -1.18504653, -0.2056499 ]]
      # b
      âŸ¨ 1.48614836
        0.23671627
       -1.02378514 âŸ©
    âŸ©
    # activation
    [[-0.7129932 ,  0.62524497]
     [-0.16051336, -0.76883635]
     [-0.23003072,  0.74505627]]
  âŸ©
  âŸ¨
    # linear
    âŸ¨
      # a
      [[ 1.97611078, -1.24412333]
       [-0.62641691, -0.80376609]
       [-2.41908317, -0.92379202]]
      # w
      [[-1.02387576,  1.12397796, -0.13191423]]
      # b
      âŸ¨-1.62328545 âŸ©
    âŸ©
    # activation
    [[ 0.64667545, -0.35627076]]
  âŸ©
âŸ©

truth â†© {
  da0 â‡ [[ 0.0        ,  0.52257901]
         [ 0.0        , -0.3269206 ]
         [ 0.0        , -0.32070404]
         [ 0.0        , -0.74079187]]
  dW1 â‡ [[0.41010002, 0.07807203, 0.13798444, 0.10502167]
         [0.0       , 0.0       , 0.0       , 0.0       ]
         [0.05283652, 0.01005865, 0.01777766, 0.0135308 ]]
  db1 â‡ âŸ¨-0.22007063
          0.0
         -0.02835349âŸ©
  dA1 â‡ [[ 0.12913162, -0.44014127]
         [-0.14175655,  0.48317296]
         [ 0.01663708, -0.05670698]]
  dW2 â‡ [[-0.39202432, -0.13325855, -0.04601089]]
  db2 â‡ âŸ¨ 0.15187861âŸ©
}

grads â† nn.LModelBackward aLâ€¿yAssessâ€¿caches

âŸ¨da0xâ€¿dw1xâ€¿db1x, da1xâ€¿dw2xâ€¿db2xâŸ© â† grads
! 6 Close truth.da0â€¿da0x
! 6 Close truth.dw1â€¿dw1x
! 5 Close truth.db1â€¿db1x
! 6 Close truth.da1â€¿da1x
! 6 Close truth.dw2â€¿dw2x
! 6 Close truth.db2â€¿db2x
#â€¢Out "0âŠ‘grads"
#â€¢Show 0âŠ‘grads
#â€¢Out "1âŠ‘grads"
#â€¢Show 1âŠ‘grads

#
# UpdateParameters
#

parameters â† âŸ¨
  âŸ¨
    # w1
    [[-0.41675785, -0.05626683, -2.1361961 ,  1.64027081]
     [-1.79343559, -0.84174737,  0.50288142, -1.24528809]
     [-1.05795222, -0.90900761,  0.55145404,  2.29220801]]
    # b1
    âŸ¨ 0.04153939
     -1.11792545
      0.53905832 âŸ©
  âŸ©
  âŸ¨
    # w2
    [[-0.5961597 , -0.0191305 ,  1.17500122]]
    # b2
    âŸ¨ -0.74787095 âŸ©
  âŸ©
âŸ©

grads â†© âŸ¨
  âŸ¨
    # da0
    âŸ¨âŸ©
    # dw1
    [[ 1.78862847,  0.43650985,  0.09649747, -1.8634927 ]
     [-0.2773882 , -0.35475898, -0.08274148, -0.62700068]
     [-0.04381817, -0.47721803, -1.31386475,  0.88462238]]
    # db1
    âŸ¨ 0.88131804
      1.70957306
      0.05003364 âŸ©
  âŸ©
  âŸ¨
    # da1
    âŸ¨âŸ©
    # dw2
    [[-0.40467741, -0.54535995, -1.54647732]]
    # db2
    âŸ¨ 0.98236743 âŸ©
  âŸ©
âŸ©

truth â†© {
  w1 â‡ [[-0.59562069, -0.09991781, -2.14584584,  1.82662008]
        [-1.76569676, -0.80627147,  0.51115557, -1.18258802]
        [-1.0535704 , -0.86128581,  0.68284052,  2.20374577]]
  b1 â‡ âŸ¨ -0.04659241
         -1.28888275
          0.53405496 âŸ©
  w2 â‡ [[-0.55569196,  0.0354055,   1.32964895]]
  b2 â‡ âŸ¨ -0.84610769 âŸ©
}

parameters â†© nn.UpdateParameters parametersâ€¿gradsâ€¿0.1

#â€¢Out "0âŠ‘0âŠ‘parameters"
#â€¢Show 0âŠ‘0âŠ‘parameters
#â€¢Out "truth.w1"
#â€¢Show truth.w1

! 6 Close (0âŠ‘0âŠ‘parameters)â€¿truth.w1
! 7 Close (1âŠ‘0âŠ‘parameters)â€¿truth.b1
! 6 Close (0âŠ‘1âŠ‘parameters)â€¿truth.w2
! 7 Close (1âŠ‘1âŠ‘parameters)â€¿truth.b2
