nn ‚Üê ‚Ä¢Import "nn.bqn"

rand ‚Üê ‚Ä¢MakeRand 0

n1 ‚Üê nn.Normal rand‚Äø‚ü®0, 1‚ü©
#‚Ä¢Show n1

n2 ‚Üê nn.Normal rand‚Äø‚ü®0, 1‚ü©
#‚Ä¢Show n2

n3 ‚Üê nn.Normal rand
#‚Ä¢Show n3

n4 ‚Üê 3 nn.Normal rand‚Äø‚ü®0, 1‚ü©
#‚Ä¢Show n4

n5 ‚Üê 3 nn.Normal rand
#‚Ä¢Show n5

n6 ‚Üê 2‚Äø3 nn.Normal rand
#‚Ä¢Show n6

ps ‚Üê nn.InitializeParameters 3‚Äø2‚Äø1
#‚Ä¢Out "w1 = "‚àæ‚Ä¢Repr ps.w1
#‚Ä¢Out "b1 = "‚àæ‚Ä¢Repr ps.b1
#‚Ä¢Out "w2 = "‚àæ‚Ä¢Repr ps.w2
#‚Ä¢Out "b2 = "‚àæ‚Ä¢Repr ps.b2

! 2‚Äø3 ‚â° ‚â¢ps.w1
! ‚ü®2‚ü© ‚â° ‚â¢ps.b1
! ‚àß¬¥=‚üú0¬®‚•äps.b1
! 1‚Äø2 ‚â° ‚â¢ps.w2
! ‚ü®1‚ü© ‚â° ‚â¢ps.b2
! ‚àß¬¥=‚üú0¬®‚•äps.b2

ws‚Äøbs ‚Üê nn.InitializeParametersDeep 5‚Äø4‚Äø3

! 2=‚â†ws
! 2=‚â†bs
! 4‚Äø5‚â°‚â¢0‚äëws
! (‚â†=‚â†‚àò‚ç∑)0‚äëws  # all unique
! (4‚•ä0)‚â°0‚äëbs
! 3‚Äø4‚â°‚â¢1‚äëws
! (‚â†=‚â†‚àò‚ç∑)1‚äëws  # all unique
! (3‚•ä0)‚â°1‚äëbs

x ‚Üê @
y ‚Üê @
a ‚Üê @
w ‚Üê @
b ‚Üê @
z ‚Üê @
aa ‚Üê @
ww ‚Üê @
bb ‚Üê @
zz ‚Üê @
aPrev ‚Üê @
aL ‚Üê @
caches ‚Üê @

a ‚Ü© [[ 1.62434536, -0.61175641]
     [-0.52817175, -1.07296862]
     [ 0.86540763, -2.3015387 ]]
w ‚Ü© [[1.74481176, -0.7612069,   0.3190391]]
b ‚Ü© ‚ü®-0.24937038‚ü©
z ‚Ü© [[ 3.26295337, -1.23429987]]

zz‚Äø‚ü®aa‚Äøww‚Äøbb‚ü© ‚Ü© nn.LinearForward a‚Äøw‚Äøb

Close ‚Üê {
  d ùïä vs: ‚àß¬¥ 0‚ä∏=¬® ‚â†‚àò‚â¢¬® vs ? (1=‚â†‚àò‚ç∑) { (10‚ãÜd)√∑Àú‚åäùï©√ó(10‚ãÜd) }¬® vs ;
  d ùïä vs: (1‚â†‚â†‚àò‚ç∑) ‚â¢¬® vs ? 0 ;
  d ùïä vs: (1=‚â†‚àò‚ç∑) { (10‚ãÜd)√∑Àú‚åäùï©√ó(10‚ãÜd) }¬® ‚•ä¬® vs
}

! (‚â¢z)‚â°‚â¢zz

! 7 Close z‚Äøzz

aPrev ‚Ü© [[-0.41675785, -0.05626683]
         [-2.1361961,   1.64027081]
         [-1.79343559, -0.84174737]]
w ‚Ü© [[ 0.50288142, -1.24528809, -1.05795222]]
b ‚Ü© ‚ü®-0.90900761‚ü©

truth ‚Üê {
  aWithSigmoid ‚áê [[0.96890023, 0.11013289]]
  aWithReLU ‚áê [[3.43896131, 0.0        ]]
}

aWithSigmoid‚Äø¬∑ ‚Üê nn.LinearActivationForward aPrev‚Äøw‚Äøb‚Äønn.sigmoid
aWithReLU‚Äø¬∑ ‚Üê nn.LinearActivationForward aPrev‚Äøw‚Äøb‚Äønn.reLU

#‚Ä¢Out "aWithSigmoid"
#‚Ä¢Show truth.aWithSigmoid
#‚Ä¢Show aWithSigmoid

#‚Ä¢Out "aWithReLU"
#‚Ä¢Show truth.aWithReLU
#‚Ä¢Show aWithReLU

! 7 Close truth.aWithSigmoid‚ÄøaWithSigmoid
! 7 Close truth.aWithReLU‚ÄøaWithReLU

x ‚Ü© [[-0.31178367,  0.72900392,  0.21782079, -0.8990918 ]
     [-2.48678065,  0.91325152,  1.12706373, -1.51409323]
     [ 1.63929108, -0.42989360,  2.63128056,  0.60182225]
     [-0.33588161,  1.23773784,  0.11112817,  0.12915125]
     [ 0.07612761, -0.15512816,  0.63422534,  0.810655  ]]
ws ‚Ü© ‚ü®
      [[ 0.35480861,  1.81259031, -1.3564758 , -0.46363197,  0.82465384]
       [-1.17643148,  1.56448966,  0.71270509, -0.1810066 ,  0.53419953]
       [-0.58661296, -1.48185327,  0.85724762,  0.94309899,  0.11444143]
       [-0.02195668, -2.12714455, -0.83440747, -0.46550831,  0.23371059]]
      [[-0.12673638, -1.36861282,  1.21848065, -0.85750144]
       [-0.56147088, -1.0335199 ,  0.35877096,  1.07368134]
       [-0.37550472,  0.39636757, -0.47144628,  2.33660781]]
      [[ 0.9398248 ,  0.42628539, -0.75815703]]
     ‚ü©
bs ‚Ü© ‚ü®‚ü® 1.38503523
       -0.51962709
       -0.78015214
        0.95560959 ‚ü©
      ‚ü® 1.50278553
       -0.59545972
        0.52834106 ‚ü©
      ‚ü®-0.16236698 ‚ü©
     ‚ü©

truthAL ‚Üê [[0.03921668, 0.70498921, 0.19734387, 0.04728177]]

aL‚Äøcaches ‚Ü© nn.LModelForward x‚Äøws‚Äøbs

#‚Ä¢Show truthAL
#‚Ä¢Show aL

! 7 Close truthAL‚ÄøaL
! 3=‚â†caches

y ‚Ü© [[1, 1, 0]]
aL ‚Ü© [[0.8, 0.9, 0.4]]

truthCost ‚Üê 0.2797765635793422

cost ‚Üê nn.ComputeCost aL‚Äøy

! 7 Close truthCost‚Äøcost

dz ‚Üê [[ 1.62434536, -0.61175641, -0.52817175, -1.07296862]
      [ 0.86540763, -2.3015387 ,  1.74481176, -0.7612069 ]
      [ 0.3190391 , -0.24937038,  1.46210794, -2.06014071]]
linear_cache ‚Üê ‚ü®
  # a prev
  [[-0.3224172 , -0.38405435,  1.13376944, -1.09989127]
   [-0.17242821, -0.87785842,  0.04221375,  0.58281521]
   [-1.10061918,  1.14472371,  0.90159072,  0.50249434]
   [ 0.90085595, -0.68372786, -0.12289023, -0.93576943]
   [-0.26788808,  0.53035547, -0.69166075, -0.39675353]]
  # w
  [[-0.6871727 , -0.84520564, -0.67124613, -0.0126646 , -1.11731035]
   [ 0.2344157 ,  1.65980218,  0.74204416, -0.19183555, -0.88762896]
   [-0.74715829,  1.6924546 ,  0.05080775, -0.63699565,  0.19091548]]
  # b
  ‚ü® 2.10025514
    0.12015895
    0.61720311 ‚ü©
‚ü©

truth ‚Ü© {
  daPrev ‚áê [[-1.15171336,  0.06718465, -0.3204696 ,  2.09812712]
            [ 0.60345879, -3.72508701,  5.81700741, -3.84326836]
            [-0.4319552 , -1.30987417,  1.72354705,  0.05070578]
            [-0.38981415,  0.60811244, -1.25938424,  1.47191593]
            [-2.52214926,  2.67882552, -0.67947465,  1.48119548]]
  dw ‚áê [[ 0.07313866, -0.0976715 , -0.87585828,  0.73763362,  0.00785716]
        [ 0.85508818,  0.37530413, -0.59912655,  0.71278189, -0.58931808]
        [ 0.97913304, -0.24376494, -0.08839671,  0.55151192, -0.10290907]]
  db ‚áê ‚ü® -0.14713786
         -0.11313155
         -0.13209101 ‚ü©
}

daPrev‚Äødw‚Äødb ‚Üê nn.LinearBackward dz‚Äølinear_cache

#‚Ä¢Show daPrev
#‚Ä¢Show dw
#‚Ä¢Show db

! 6 Close truth.daPrev‚ÄødaPrev
! 7 Close truth.dw‚Äødw
! 7 Close truth.db‚Äødb


daL ‚Üê [[-0.41675785, -0.05626683]]
linearActivationCache ‚Üê ‚ü®
  ‚ü®
    [[-2.1361961 ,  1.64027081]
     [-1.79343559, -0.84174737]
     [ 0.50288142, -1.24528809]]
    [[-1.05795222, -0.90900761,  0.55145404]]
    ‚ü® 2.29220801 ‚ü©
  ‚ü©
  [[ 0.04153939, -1.11792545]]
‚ü©

truthSigmoid ‚Üê {
  daPrev ‚áê [[ 0.11017994,  0.01105339]
            [ 0.09466817,  0.00949723]
            [-0.05743092, -0.00576154]]
  dw ‚áê [[ 0.10266786,  0.09778551, -0.01968084]]
  db ‚áê ‚ü® -0.05729622 ‚ü©
}

truthReLU ‚Üê {
  daPrev ‚áê [[ 0.44090989,  0.0        ]
            [ 0.37883606,  0.0        ]
            [-0.2298228 ,  0.0        ]]
  dw ‚áê [[ 0.44513824,  0.37371418, -0.10478989]]
  db ‚áê ‚ü® -0.20837892 ‚ü©
}

daPrev‚Äødw‚Äødb ‚Ü© nn.LinearActivationBackward daL‚ÄølinearActivationCache‚Äønn.sigmoidBackward

#‚Ä¢Show daPrev
#‚Ä¢Show dw
#‚Ä¢Show db

! 6 Close truthSigmoid.daPrev‚ÄødaPrev
! 7 Close truthSigmoid.dw‚Äødw
! 7 Close truthSigmoid.db‚Äødb

daPrev‚Äødw‚Äødb ‚Ü© nn.LinearActivationBackward daL‚ÄølinearActivationCache‚Äønn.reLUBackward

#‚Ä¢Show daPrev
#‚Ä¢Show dw
#‚Ä¢Show db

! 6 Close truthReLU.daPrev‚ÄødaPrev
! 7 Close truthReLU.dw‚Äødw
! 7 Close truthReLU.db‚Äødb

#
# LModelBackward
#

aL ‚Ü© [[1.78862847, 0.43650985]]
yAssess ‚Üê [[1, 0]]
#yAssess ‚Üê ‚ü®1, 0‚ü©
caches ‚Ü© ‚ü®
  ‚ü®
    ‚ü®
      # a
      [[ 0.09649747, -1.8634927 ]
       [-0.2773882 , -0.35475898]
       [-0.08274148, -0.62700068]
       [-0.04381817, -0.47721803]]
      # w
      [[-1.31386475,  0.88462238,  0.88131804,  1.70957306]
       [ 0.05003364, -0.40467741, -0.54535995, -1.54647732]
       [ 0.98236743, -1.10106763, -1.18504653, -0.2056499 ]]
      # b
      ‚ü® 1.48614836
        0.23671627
       -1.02378514 ‚ü©
    ‚ü©
    [[-0.7129932 ,  0.62524497]
     [-0.16051336, -0.76883635]
     [-0.23003072,  0.74505627]]
  ‚ü©
  ‚ü®
    ‚ü®
      # a
      [[ 1.97611078, -1.24412333]
       [-0.62641691, -0.80376609]
       [-2.41908317, -0.92379202]]
      # w
      [[-1.02387576,  1.12397796, -0.13191423]]
      # b
      ‚ü®-1.62328545 ‚ü©
    ‚ü©
    [[ 0.64667545, -0.35627076]]
  ‚ü©
‚ü©

truth ‚Ü© {
  dW1 ‚áê [[0.41010002, 0.07807203, 0.13798444, 0.10502167]
         [0.0       , 0.0       , 0.0       , 0.0       ]
         [0.05283652, 0.01005865, 0.01777766, 0.0135308 ]]
  db1 ‚áê [[-0.22007063]
         [ 0.0       ]
         [-0.02835349]]
  dA1 ‚áê [[ 0.12913162, -0.44014127]
         [-0.14175655,  0.48317296]
         [ 0.01663708, -0.05670698]]
}

grads ‚Üê nn.LModelBackward aL‚ÄøyAssess‚Äøcaches

#‚Ä¢Out "0‚äëgrads"
#‚Ä¢Show 0‚äëgrads
#‚Ä¢Out "1‚äëgrads"
#‚Ä¢Show 1‚äëgrads

#
# UpdateParameters
#

parameters ‚Üê ‚ü®
  ‚ü®
    # w1
    [[-0.41675785, -0.05626683, -2.1361961 ,  1.64027081]
     [-1.79343559, -0.84174737,  0.50288142, -1.24528809]
     [-1.05795222, -0.90900761,  0.55145404,  2.29220801]]
    # b1
    ‚ü® 0.04153939
     -1.11792545
      0.53905832 ‚ü©
  ‚ü©
  ‚ü®
    # w2
    [[-0.5961597 , -0.0191305 ,  1.17500122]]
    # b2
    ‚ü® -0.74787095 ‚ü©
  ‚ü©
‚ü©

grads ‚Ü© ‚ü®
  ‚ü®
    # da0
    ‚ü®‚ü©
    # dw1
    [[ 1.78862847,  0.43650985,  0.09649747, -1.8634927 ]
     [-0.2773882 , -0.35475898, -0.08274148, -0.62700068]
     [-0.04381817, -0.47721803, -1.31386475,  0.88462238]]
    # db1
    ‚ü® 0.88131804
      1.70957306
      0.05003364 ‚ü©
  ‚ü©
  ‚ü®
    # da1
    ‚ü®‚ü©
    # dw2
    [[-0.40467741, -0.54535995, -1.54647732]]
    # db2
    ‚ü® 0.98236743 ‚ü©
  ‚ü©
‚ü©

truth ‚Ü© {
  w1 ‚áê [[-0.59562069, -0.09991781, -2.14584584,  1.82662008]
        [-1.76569676, -0.80627147,  0.51115557, -1.18258802]
        [-1.0535704 , -0.86128581,  0.68284052,  2.20374577]]
  b1 ‚áê ‚ü® -0.04659241
         -1.28888275
          0.53405496 ‚ü©
  w2 ‚áê [[-0.55569196,  0.0354055,   1.32964895]]
  b2 ‚áê ‚ü® -0.84610769 ‚ü©
}

parameters ‚Ü© nn.UpdateParameters parameters‚Äøgrads‚Äø0.1

#‚Ä¢Out "0‚äë0‚äëparameters"
#‚Ä¢Show 0‚äë0‚äëparameters
#‚Ä¢Out "truth.w1"
#‚Ä¢Show truth.w1

! 6 Close (0‚äë0‚äëparameters)‚Äøtruth.w1
! 7 Close (1‚äë0‚äëparameters)‚Äøtruth.b1
! 6 Close (0‚äë1‚äëparameters)‚Äøtruth.w2
! 7 Close (1‚äë1‚äëparameters)‚Äøtruth.b2
