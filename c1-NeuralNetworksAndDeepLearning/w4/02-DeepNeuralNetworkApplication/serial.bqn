eltype2bit â† âŸ¨1,8,16,32,64,8â€¿'c',16â€¿'c',32â€¿'c'âŸ©
eltypeWidth â† âŸ¨1,1,2,4,8,1,2,4âŸ©

SStep â† â€¢Typeâ—¶âŸ¨
  {
    x â† â€¢internal.Squeeze ğ•©
    eltype â† â€¢internal.ElTypeğ•©
    âŸ¨
      âŸ¨0, eltypeâŸ©
      32â€¿8â€¢bit._cast â‹ˆ=x
      64â€¿8â€¢bit._cast â‰¢x
      {
        eltype=8? SStepÂ¨ â¥Šx;
        âŸ¨eltypeâŠ‘eltype2bit, 8âŸ©â€¢bit._cast (8Ã—Â·âŒˆâ‰ Ã·8Ë™)âŠ¸â†‘âŸ(0=eltype) â¥Šx
      }
    âŸ©
  }
  { âŸ¨âŸ¨1âŸ©, 64â€¿8â€¢bit._castâ‹ˆğ•©âŸ© }
  { âŸ¨âŸ¨2âŸ©, 32â€¿8â€¢bit._castâ‹ˆğ•©âŸ© }
  {ğ•Š:!"Cannot serialize functions"}
  {ğ•Š:!"Cannot serialize 1-modifiers"}
  {ğ•Š:!"Cannot serialize 2-modifiers"}
  {ğ•Š:!"Cannot serialize namespaces"}
âŸ©

Serialize â‡ {
  lists â† âŸ¨âŸ©
  {0=â€¢TypeâŠ‘ğ•©? ğ•ŠÂ¨ğ•©; listsâˆ¾â†©<ğ•©} SStep ğ•©
  âˆ¾lists
}
Deserialize â‡ {
  sâ†ğ•©
  offâ†0
  Next â† {râ†ğ•©â†‘offâ†“s â‹„ off+â†©ğ•© â‹„ r}
  Read â† { ğ•Š:
    type â† âŠ‘Next 1
    typeâ—¶âŸ¨
      {ğ•Š:
        et â† âŠ‘Next 1
        rank â† âŠ‘8â€¿32â€¢bit._cast Next 4
        shape â† 8â€¿64â€¢bit._cast Next rankÃ—8
        shapeâ¥Š{
          et=8? ReadÂ¨ â†•Ã—Â´shape;
          âŸ¨8, etâŠ‘eltype2bitâŸ©â€¢bit._cast Next (âŒˆÃ·âŸœ8)âŸ(0=et) (etâŠ‘eltypeWidth)Ã—Â´shape
        }
      }
      {ğ•Š: âŠ‘âŸ¨8, 64    âŸ©â€¢bit._cast Next 8}
      {ğ•Š: âŠ‘âŸ¨8, 32â€¿'c'âŸ©â€¢bit._cast Next 4}
    âŸ©@
  }
  r â† Read@
  off=â‰ s? r;
  ! "invalid input: data after end"
}
